---
import {
  Github,
  Linkedin,
  Mail,
  User,
  AtSign,
  Pencil,
  MessagesSquare,
} from "lucide-react";

const { t } = Astro.props as { t: Function };
---

<section
  id="contact"
  class="project-section scroll-mt-5 md:scroll-mt-24 flex flex-col items-center gap-6 md:opacity-0"
  data-animation="visible-left"
  aria-label={t("contact.title")}
  data-copied={t("contact.copied")}
  data-error={t("contact.error")}
>
  <div class="flex flex-col gap-4">
    <h2 class="text-3xl font-bold tracking-tighter text-center shiny-text">
      {t("contact.title")}
      <MessagesSquare className="inline size-7 text-blue-400 ml-1" />
    </h2>
    <p class="text-blue-100 max-w-[700px] text-center">
      {t("contact.description")}
    </p>
  </div>
  <div class="flex justify-evenly w-full">
    <a
      href="https://github.com/RolandoU548"
      target="_blank"
      class="relative group flex justify-center items-center bg-[linear-gradient(145deg,#50506070,#50506010)] backdrop-blur-md rounded-full h-20 w-20 transition duration-300 hover:bg-blue-950 border-blue-300 hover:border hover:-translate-y-1 hover:shadow-[0_0_15px_rgba(0,_114,_255,_0.4)]"
    >
      <div
        class="hidden sm:block p-3 absolute bg-blue-500 w-max -top-16 rounded-lg opacity-0 transition-opacity duration-300 group-hover:opacity-100 before:absolute before:-bottom-4 before:left-1/2 before:-translate-x-1/2 before:border-8 before:border-transparent before:border-t-blue-500 pointer-events-none group-hover:pointer-events-auto"
      >
        {t("contact.githubLabel")}
      </div>
      <span
        class="group-hover:hidden group-hover:opacity-0 transition-discrete starting:opacity-0 duration-300 bg-blue-500 size-3 rounded-full absolute top-1.5 right-1.5 pointer-events-none"
      >
        <span
          class="absolute inline-flex h-full w-full animate-ping rounded-full bg-blue-400 opacity-50"
        ></span>
      </span>
      <Github />
    </a>
    <a
      href="https://www.linkedin.com/in/rolando-uzc%C3%A1tegui/"
      target="_blank"
      class="relative group flex justify-center items-center bg-[linear-gradient(145deg,#50506070,#50506010)] backdrop-blur-md rounded-full h-20 w-20 transition duration-300 hover:bg-blue-950 border-blue-300 hover:border hover:-translate-y-1 hover:shadow-[0_0_15px_rgba(0,_114,_255,_0.4)]"
    >
      <div
        class="hidden sm:block p-3 absolute bg-blue-500 w-max -top-16 rounded-lg opacity-0 transition-opacity duration-300 group-hover:opacity-100 before:absolute before:-bottom-4 before:left-1/2 before:-translate-x-1/2 before:border-8 before:border-transparent before:border-t-blue-500 pointer-events-none group-hover:pointer-events-auto"
      >
        {t("contact.linkedinLabel")}
      </div>
      <span
        class="group-hover:hidden group-hover:opacity-0 transition-discrete starting:opacity-0 duration-300 bg-blue-500 size-3 rounded-full absolute top-1.5 right-1.5 pointer-events-none"
      >
        <span
          class="absolute inline-flex h-full w-full animate-ping rounded-full bg-blue-400 opacity-50"
        ></span>
      </span>
      <Linkedin />
    </a>
    <a
      href="mailto:rolandou548@gmail.com"
      class="mail-bubble relative group flex justify-center items-center bg-[linear-gradient(145deg,#50506070,#50506010)] backdrop-blur-md rounded-full h-20 w-20 transition duration-300 hover:bg-blue-950 border-blue-300 hover:border hover:-translate-y-1 hover:shadow-[0_0_15px_rgba(0,_114,_255,_0.4)]"
      data-email={t("contact.emailLabel")}
    >
      <div
        class="hidden sm:block p-3 absolute bg-blue-500 w-max -top-16 rounded-lg opacity-0 transition-opacity duration-300 group-hover:opacity-100 before:absolute before:-bottom-4 before:left-1/2 before:-translate-x-1/2 before:border-8 before:border-transparent before:border-t-blue-500 pointer-events-none group-hover:pointer-events-auto"
      >
        {t("contact.emailLabel")}
      </div>
      <span
        class="group-hover:hidden group-hover:opacity-0 transition-discrete starting:opacity-0 duration-300 bg-blue-500 size-3 rounded-full absolute top-1.5 right-1.5 pointer-events-none"
      >
        <span
          class="absolute inline-flex h-full w-full animate-ping rounded-full bg-blue-400 opacity-50"
        ></span>
      </span>
      <Mail />
    </a>
  </div>
  <p>{t("contact.or")}</p>
  <form
    class="w-full grid grid-cols-1 md:grid-cols-2 gap-5 p-4 rounded-lg bg-[linear-gradient(145deg,#1e293b80,#1e293b33)] backdrop-blur-md border border-blue-500/20"
  >
    <div class="relative">
      <label for="name">{t("contact.form.name")}</label>
      <User size={18} className="absolute bottom-3 left-3 text-blue-400" />
      <input
        type="text"
        id="name"
        name="name"
        autocomplete="name"
        placeholder={t("contact.form.namePlaceholder")}
        required
        class="contact-input rounded border border-blue-500/20 outline-0 w-full p-2 pl-10 text-blue-300 mt-2 focus:border-blue-400 focus:shadow-[0_0_15px_rgba(79,172,254,0.5)] placeholder:text-white placeholder:opacity-40"
      />
      <div
        class="glow-effect absolute w-full h-0.5 -bottom-[8%] left-0 bg-blue-500 transition-all duration-300"
      >
      </div>
    </div>
    <div class="relative">
      <label for="email">{t("contact.form.email")}</label>
      <AtSign size={18} className="absolute bottom-3 left-3 text-blue-400" />
      <input
        type="text"
        id="email"
        name="email"
        autocomplete="email"
        placeholder={t("contact.form.emailPlaceholder")}
        required
        class="contact-input rounded border border-blue-500/20 outline-0 w-full p-2 pl-10 text-blue-300 mt-2 focus:border-blue-400 focus:shadow-[0_0_15px_rgba(79,172,254,0.5)] placeholder:text-white placeholder:opacity-40"
      />
      <div
        class="glow-effect absolute w-full h-0.5 -bottom-[8%] left-0 bg-blue-500 transition-all duration-300"
      >
      </div>
    </div>
    <div class="relative col-span-full">
      <label for="subject">{t("contact.form.subject")}</label>
      <Pencil size={18} className="absolute bottom-3 left-3 text-blue-400" />
      <input
        id="subject"
        name="subject"
        required
        type="text"
        placeholder={t("contact.form.subjectPlaceholder")}
        class="contact-input rounded border border-blue-500/20 outline-0 w-full p-2 pl-10 text-blue-300 mt-2 focus:border-blue-400 focus:shadow-[0_0_15px_rgba(79,172,254,0.5)] placeholder:text-white placeholder:opacity-40"
      />
      <div
        class="glow-effect absolute w-full h-0.5 -bottom-[8%] left-0 bg-blue-500 transition-all duration-300"
      >
      </div>
    </div>
    <div class="relative col-span-full">
      <label for="message">{t("contact.form.message")}</label>
      <Mail size={18} className="absolute top-11 left-3 text-blue-400" />
      <textarea
        id="message"
        name="message"
        required
        placeholder={t("contact.form.messagePlaceholder")}
        rows="4"
        class="contact-input rounded border border-blue-500/20 outline-0 w-full p-2 pl-10 text-blue-300 mt-2 focus:border-blue-400 focus:shadow-[0_0_15px_rgba(79,172,254,0.5)] placeholder:text-white placeholder:opacity-40"
      ></textarea>
      <div
        class="glow-effect absolute w-full h-0.5 bottom-0 left-0 bg-blue-500 transition-all duration-300"
      >
      </div>
    </div>
    <button
      class="relative col-span-full cursor-pointer bg-linear-to-r from-blue-700 to-blue-500 py-2 px-4 rounded-md font-semibold overflow-hidden transition-all duration-300 ease-out hover:-translate-0.5 hover:shadow-[0_4px_15px_rgba(0,_114,_255,_0.4)] before:absolute before:top-0 before:-left-full before:w-full before:h-full before:bg-gradient-to-r before:from-transparent before:via-white/20 before:to-transparent before:transition-all before:duration-500 before:ease-in-out hover:before:left-full"
      >{t("contact.form.submit")}</button
    >
  </form>
</section>

<style>
  .glow-effect {
    scale: 0 1;
  }

  .contact-input:focus ~ .glow-effect {
    transform-origin: left;
    scale: 1 1;
  }
</style>

<script>
  (function () {
    const section = document.querySelector("#contact") as HTMLElement | null;
    const COPIED_MSG = section?.dataset.copied;
    const COPIED_ERROR = section?.dataset.error;

    document.querySelectorAll(".mail-bubble").forEach((el) => {
      const element = el as HTMLElement;
      element.addEventListener("click", () => {
        const email = element.dataset.email || "rolandou548@gmail.com";
        navigator.clipboard
          .writeText(email)
          .then(() => alert(COPIED_MSG))
          .catch((err) => console.error("Error al copiar", err));
      });
    });

    document
      .querySelector("form")
      ?.addEventListener("submit", async function (e) {
        e.preventDefault();

        const form = this;
        const formData = {
          name:
            (form.elements.namedItem("name") as HTMLInputElement)?.value || "",
          email:
            (form.elements.namedItem("email") as HTMLInputElement)?.value || "",
          subject:
            (form.elements.namedItem("subject") as HTMLInputElement)?.value ||
            "",
          message:
            (form.elements.namedItem("message") as HTMLTextAreaElement)
              ?.value || "",
        };

        try {
          const response = await fetch(import.meta.env.PUBLIC_CONTACT_API_URL, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(formData),
          });

          const result = await response.json();

          if (result.success) {
            alert("Message sent successfully!");
            form.reset();
          } else {
            alert("Error: " + (result.message || "Failed to send message"));
          }
        } catch (error) {
          alert("Failed to send message. Please try again later.");
          console.error(error);
        }
      });
  })();
</script>
